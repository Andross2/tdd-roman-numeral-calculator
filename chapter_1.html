<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.6.8" />
<title></title>
<style type="text/css">
/* Shared CSS for AsciiDoc xhtml11 and html5 backends */

/* Default font. */
body {
  font-family: Georgia,serif;
}

/* Title font. */
h1, h2, h3, h4, h5, h6,
div.title, caption.title,
thead, p.table.header,
#toctitle,
#author, #revnumber, #revdate, #revremark,
#footer {
  font-family: Arial,Helvetica,sans-serif;
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}
h5 {
  font-size: 1.0em;
}

div.sectionbody {
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}
ul > li     { color: #aaa; }
ul > li > * { color: black; }

.monospaced, code, pre {
  font-family: "Courier New", Courier, monospace;
  font-size: inherit;
  color: navy;
  padding: 0;
  margin: 0;
}


#author {
  color: #527bbd;
  font-weight: bold;
  font-size: 1.1em;
}
#email {
}
#revnumber, #revdate, #revremark {
}

#footer {
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.0em;
  margin-bottom: 2.0em;
  margin-right: 10%;
  color: #606060;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid #dddddd;
  border-left: 4px solid #f0f0f0;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid #dddddd;
  border-left: 5px solid #f0f0f0;
  background: #f8f8f8;
  padding: 0.5em;
}

div.quoteblock, div.verseblock {
  padding-left: 1.0em;
  margin-left: 1.0em;
  margin-right: 10%;
  border-left: 5px solid #f0f0f0;
  color: #888;
}

div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock > pre.content {
  font-family: inherit;
  font-size: inherit;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 3px solid #dddddd;
}

div.exampleblock > div.content {
  border-left: 3px solid #dddddd;
  padding-left: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; vertical-align: text-bottom; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}

div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

.footnote, .footnoteref {
  font-size: 0.8em;
}

span.footnote, span.footnoteref {
  vertical-align: super;
}

#footnotes {
  margin: 20px 0 20px 0;
  padding: 7px 0 0 0;
}

#footnotes div.footnote {
  margin: 0 0 5px 0;
}

#footnotes hr {
  border: none;
  border-top: 1px solid silver;
  height: 1px;
  text-align: left;
  margin-left: 0;
  width: 20%;
  min-width: 100px;
}

div.colist td {
  padding-right: 0.5em;
  padding-bottom: 0.3em;
  vertical-align: top;
}
div.colist td img {
  margin-top: 0.3em;
}

@media print {
  #footer-badges { display: none; }
}

#toc {
  margin-bottom: 2.5em;
}

#toctitle {
  color: #527bbd;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel0, div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}

span.aqua { color: aqua; }
span.black { color: black; }
span.blue { color: blue; }
span.fuchsia { color: fuchsia; }
span.gray { color: gray; }
span.green { color: green; }
span.lime { color: lime; }
span.maroon { color: maroon; }
span.navy { color: navy; }
span.olive { color: olive; }
span.purple { color: purple; }
span.red { color: red; }
span.silver { color: silver; }
span.teal { color: teal; }
span.white { color: white; }
span.yellow { color: yellow; }

span.aqua-background { background: aqua; }
span.black-background { background: black; }
span.blue-background { background: blue; }
span.fuchsia-background { background: fuchsia; }
span.gray-background { background: gray; }
span.green-background { background: green; }
span.lime-background { background: lime; }
span.maroon-background { background: maroon; }
span.navy-background { background: navy; }
span.olive-background { background: olive; }
span.purple-background { background: purple; }
span.red-background { background: red; }
span.silver-background { background: silver; }
span.teal-background { background: teal; }
span.white-background { background: white; }
span.yellow-background { background: yellow; }

span.big { font-size: 2em; }
span.small { font-size: 0.6em; }

span.underline { text-decoration: underline; }
span.overline { text-decoration: overline; }
span.line-through { text-decoration: line-through; }

div.unbreakable { page-break-inside: avoid; }


/*
 * xhtml11 specific
 *
 * */

div.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.tableblock > table {
  border: 3px solid #527bbd;
}
thead, p.table.header {
  font-weight: bold;
  color: #527bbd;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overriden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


/*
 * html5 specific
 *
 * */

table.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
thead, p.tableblock.header {
  font-weight: bold;
  color: #527bbd;
}
p.tableblock {
  margin-top: 0;
}
table.tableblock {
  border-width: 3px;
  border-spacing: 0px;
  border-style: solid;
  border-color: #527bbd;
  border-collapse: collapse;
}
th.tableblock, td.tableblock {
  border-width: 1px;
  padding: 4px;
  border-style: solid;
  border-color: #527bbd;
}

table.tableblock.frame-topbot {
  border-left-style: hidden;
  border-right-style: hidden;
}
table.tableblock.frame-sides {
  border-top-style: hidden;
  border-bottom-style: hidden;
}
table.tableblock.frame-none {
  border-style: hidden;
}

th.tableblock.halign-left, td.tableblock.halign-left {
  text-align: left;
}
th.tableblock.halign-center, td.tableblock.halign-center {
  text-align: center;
}
th.tableblock.halign-right, td.tableblock.halign-right {
  text-align: right;
}

th.tableblock.valign-top, td.tableblock.valign-top {
  vertical-align: top;
}
th.tableblock.valign-middle, td.tableblock.valign-middle {
  vertical-align: middle;
}
th.tableblock.valign-bottom, td.tableblock.valign-bottom {
  vertical-align: bottom;
}


/*
 * manpage specific
 *
 * */

body.manpage h1 {
  padding-top: 0.5em;
  padding-bottom: 0.5em;
  border-top: 2px solid silver;
  border-bottom: 2px solid silver;
}
body.manpage h2 {
  border-style: none;
}
body.manpage div.sectionbody {
  margin-left: 3em;
}

@media print {
  body.manpage div#toc { display: none; }
}


</style>
<script type="text/javascript">
/*<![CDATA[*/
var asciidoc = {  // Namespace.

/////////////////////////////////////////////////////////////////////
// Table Of Contents generator
/////////////////////////////////////////////////////////////////////

/* Author: Mihai Bazon, September 2002
 * http://students.infoiasi.ro/~mishoo
 *
 * Table Of Content generator
 * Version: 0.4
 *
 * Feel free to use this script under the terms of the GNU General Public
 * License, as long as you do not remove or alter this notice.
 */

 /* modified by Troy D. Hanson, September 2006. License: GPL */
 /* modified by Stuart Rackham, 2006, 2009. License: GPL */

// toclevels = 1..4.
toc: function (toclevels) {

  function getText(el) {
    var text = "";
    for (var i = el.firstChild; i != null; i = i.nextSibling) {
      if (i.nodeType == 3 /* Node.TEXT_NODE */) // IE doesn't speak constants.
        text += i.data;
      else if (i.firstChild != null)
        text += getText(i);
    }
    return text;
  }

  function TocEntry(el, text, toclevel) {
    this.element = el;
    this.text = text;
    this.toclevel = toclevel;
  }

  function tocEntries(el, toclevels) {
    var result = new Array;
    var re = new RegExp('[hH]([1-'+(toclevels+1)+'])');
    // Function that scans the DOM tree for header elements (the DOM2
    // nodeIterator API would be a better technique but not supported by all
    // browsers).
    var iterate = function (el) {
      for (var i = el.firstChild; i != null; i = i.nextSibling) {
        if (i.nodeType == 1 /* Node.ELEMENT_NODE */) {
          var mo = re.exec(i.tagName);
          if (mo && (i.getAttribute("class") || i.getAttribute("className")) != "float") {
            result[result.length] = new TocEntry(i, getText(i), mo[1]-1);
          }
          iterate(i);
        }
      }
    }
    iterate(el);
    return result;
  }

  var toc = document.getElementById("toc");
  if (!toc) {
    return;
  }

  // Delete existing TOC entries in case we're reloading the TOC.
  var tocEntriesToRemove = [];
  var i;
  for (i = 0; i < toc.childNodes.length; i++) {
    var entry = toc.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div'
     && entry.getAttribute("class")
     && entry.getAttribute("class").match(/^toclevel/))
      tocEntriesToRemove.push(entry);
  }
  for (i = 0; i < tocEntriesToRemove.length; i++) {
    toc.removeChild(tocEntriesToRemove[i]);
  }

  // Rebuild TOC entries.
  var entries = tocEntries(document.getElementById("content"), toclevels);
  for (var i = 0; i < entries.length; ++i) {
    var entry = entries[i];
    if (entry.element.id == "")
      entry.element.id = "_toc_" + i;
    var a = document.createElement("a");
    a.href = "#" + entry.element.id;
    a.appendChild(document.createTextNode(entry.text));
    var div = document.createElement("div");
    div.appendChild(a);
    div.className = "toclevel" + entry.toclevel;
    toc.appendChild(div);
  }
  if (entries.length == 0)
    toc.parentNode.removeChild(toc);
},


/////////////////////////////////////////////////////////////////////
// Footnotes generator
/////////////////////////////////////////////////////////////////////

/* Based on footnote generation code from:
 * http://www.brandspankingnew.net/archive/2005/07/format_footnote.html
 */

footnotes: function () {
  // Delete existing footnote entries in case we're reloading the footnodes.
  var i;
  var noteholder = document.getElementById("footnotes");
  if (!noteholder) {
    return;
  }
  var entriesToRemove = [];
  for (i = 0; i < noteholder.childNodes.length; i++) {
    var entry = noteholder.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div' && entry.getAttribute("class") == "footnote")
      entriesToRemove.push(entry);
  }
  for (i = 0; i < entriesToRemove.length; i++) {
    noteholder.removeChild(entriesToRemove[i]);
  }

  // Rebuild footnote entries.
  var cont = document.getElementById("content");
  var spans = cont.getElementsByTagName("span");
  var refs = {};
  var n = 0;
  for (i=0; i<spans.length; i++) {
    if (spans[i].className == "footnote") {
      n++;
      var note = spans[i].getAttribute("data-note");
      if (!note) {
        // Use [\s\S] in place of . so multi-line matches work.
        // Because JavaScript has no s (dotall) regex flag.
        note = spans[i].innerHTML.match(/\s*\[([\s\S]*)]\s*/)[1];
        spans[i].innerHTML =
          "[<a id='_footnoteref_" + n + "' href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
        spans[i].setAttribute("data-note", note);
      }
      noteholder.innerHTML +=
        "<div class='footnote' id='_footnote_" + n + "'>" +
        "<a href='#_footnoteref_" + n + "' title='Return to text'>" +
        n + "</a>. " + note + "</div>";
      var id =spans[i].getAttribute("id");
      if (id != null) refs["#"+id] = n;
    }
  }
  if (n == 0)
    noteholder.parentNode.removeChild(noteholder);
  else {
    // Process footnoterefs.
    for (i=0; i<spans.length; i++) {
      if (spans[i].className == "footnoteref") {
        var href = spans[i].getElementsByTagName("a")[0].getAttribute("href");
        href = href.match(/#.*/)[0];  // Because IE return full URL.
        n = refs[href];
        spans[i].innerHTML =
          "[<a href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
      }
    }
  }
},

install: function(toclevels) {
  var timerId;

  function reinstall() {
    asciidoc.footnotes();
    if (toclevels) {
      asciidoc.toc(toclevels);
    }
  }

  function reinstallAndRemoveTimer() {
    clearInterval(timerId);
    reinstall();
  }

  timerId = setInterval(reinstall, 500);
  if (document.addEventListener)
    document.addEventListener("DOMContentLoaded", reinstallAndRemoveTimer, false);
  else
    window.onload = reinstallAndRemoveTimer;
}

}
asciidoc.install();
/*]]>*/
</script>
</head>
<body class="article">
<div id="header">
</div>
<div id="content">
<div class="sect1">
<h2 id="_chapter_1_a_simple_tdd_example_the_roman_calculator">Chapter 1 - A simple TDD example - the Roman Calculator</h2>
<div class="sectionbody">
<div class="paragraph"><p>I wanted to start with a simple example.  Everyone always uses the same one,
which is a Roman Numerals, but I&#8217;m going to give it a little twist, which is
that I&#8217;ll try and use TDD to make a Roman numeral <em>calculator</em> - not a Roman
Numeral converter.  Along the way, we&#8217;ll discover something I thought was quite
cool too.</p></div>
<div class="sect2">
<h3 id="_a_first_test_for_a_minimum_viable_calculator">A first test for a minimum viable calculator</h3>
<div class="paragraph"><p>In order for our development to be truly test-driven, tests have to come first
- before we write any application code, we first write a test for it.</p></div>
<div class="paragraph"><p>We start with the simplest possible thing&#8201;&#8212;&#8201;TDD is very much an agile
methodology, so we start to think about what the "minimum viable Roman numeral
calculator" might do&#8230;  What would be just slightly better than not having a
calculator at all?  How about one that can add 1 + 1?</p></div>
<div class="paragraph"><p>Here&#8217;s the simplest possible test for that:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.6
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">from</span></span> rome <span style="font-weight: bold"><span style="color: #000080">import</span></span> add

<span style="font-weight: bold"><span style="color: #0000FF">assert</span></span> <span style="font-weight: bold"><span style="color: #000000">add</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'I'</span><span style="color: #990000">,</span> <span style="color: #FF0000">'I'</span><span style="color: #990000">)</span> <span style="color: #990000">==</span> <span style="color: #FF0000">'II'</span></tt></pre></div></div>
<div class="paragraph"><p>I&#8217;m going to save that as <code>tests.py</code>.  Let&#8217;s try running it.  &#8220;What?&#8221;, I hear
you say, &#8220;that&#8217;s totally pointless&#8201;&#8212;&#8201;we haven&#8217;t even made a rome.py, or an
add function, it&#8217;s just a waste of time to run the test now!&#8221;</p></div>
<div class="paragraph"><p>The reason I can hear you saying that is because it&#8217;s exactly what I said when
I first started learning TDD at PythonAnywhere.  Believe me when I say that I
was dragged incredibly reluctantly into the world of TDD.  I dragged my
heels, raged at every "pointless" bit of testing, moaned about the ridiculously
pernickety procedure we would follow&#8201;&#8212;&#8201;&#8220;but it&#8217;s obvious where we want to be,
why don&#8217;t we just skip to the end&#8221;.</p></div>
<div class="paragraph"><p>There are different justifications for it.  One is that, even though we could
easily skip a bunch of steps in these easy cases, we just do it as practice,
because it&#8217;s a great skill to have for when we get into the not-so-easy cases.
Another is that, in purely practical terms, it really doesn&#8217;t waste any serious
time, and it might even help us catch some early bugs&#8201;&#8212;&#8201;if there&#8217;s a syntax
error in our tests, we may as well catch it right now rather than later.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.6
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000000">Traceback</span></span> <span style="color: #990000">(</span>most recent call last<span style="color: #990000">):</span>
  File <span style="color: #FF0000">"tests.py"</span><span style="color: #990000">,</span> line <span style="color: #993399">1</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">in</span></span> <span style="color: #990000">&lt;</span>module<span style="color: #990000">&gt;</span>
    <span style="font-weight: bold"><span style="color: #000080">from</span></span> rome <span style="font-weight: bold"><span style="color: #000080">import</span></span> add
ImportError<span style="color: #990000">:</span> No module named rome</tt></pre></div></div>
</div>
<div class="sect2">
<h3 id="_baby_steps_small_incremental_code_changes_driven_by_the_tests">Baby steps: small, incremental code changes, driven by the tests</h3>
<div class="paragraph"><p>Once we have a failing test, the next thing to do is make the smallest possible
code change that will get the tests closer to passing.  The "Driven" bit in TDD
means we let the tests tell us what to do.  In this case, they&#8217;re complaining
of an import error, so let&#8217;s fix that - and only that.</p></div>
<div class="paragraph"><p>We can do it by creating an empty file called rome.py</p></div>
<div class="listingblock">
<div class="content">
<pre><code>touch rome.py</code></pre>
</div></div>
<div class="paragraph"><p>(if you&#8217;re on Windows, you probably won&#8217;t have the "touch" command.  I&#8217;m sure
you can figure out some other way of making an empty file called rome.py.  In
general, I&#8217;ll try and make the commands I use OS-agnostic&#8230;)</p></div>
<div class="paragraph"><p>Now we can re-run our test!</p></div>
<div class="listingblock">
<div class="content">
<pre><code>Traceback (most recent call last):
  File "tests.py", line 1, in &lt;module&gt;
    from rome import add
ImportError: cannot import name add</code></pre>
</div></div>
<div class="paragraph"><p>Progress!  We&#8217;ve moved from one kind of ImportError to another one.  Let&#8217;s fix
that!  Open up <code>rome.py</code> and add 1 line of code:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.6
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>add <span style="color: #990000">=</span> None</tt></pre></div></div>
<div class="paragraph"><p>And re-run the test</p></div>
<div class="listingblock">
<div class="content">
<pre><code>Traceback (most recent call last):
  File "tests.py", line 3, in &lt;module&gt;
    assert add('I', 'I') == 'II'
TypeError: 'NoneType' object is not callable</code></pre>
</div></div>
<div class="paragraph"><p>Yeah!  Seriously!  It&#8217;s perverse, isn&#8217;t it?  Now, I&#8217;ll admit, perhaps in real
life I would have jumped straight to defining a function called "add".</p></div>
<div class="paragraph"><p>Kent Beck put it this way:  &#8220;Do I really expect you to always write code like
this? No.  But I want you to always be <em>able</em> to&#8221;.  These sorts of baby steps
seem nonsensical when we&#8217;re dealing with an easy example like this, but once
you start talking about making changes to a complex application, being able to
use baby steps makes for a much less stressful way of coding.  Taking small
steps, with constant reference to tests, gives us reassurance that we&#8217;ll go
from code that works to code that still works without breaking anything.</p></div>
<div class="paragraph"><p>By only making minimal changes, and justifying each change with reference to
getting a test to pass, we make sure that every bit of your code is tested.  It
also tests the tests - running them frequently and seeing that they fail in the
way you expect, makes sure that the tests really work the way you think they
do.</p></div>
<div class="paragraph"><p>So let&#8217;s get them a little further along:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.6
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">add</span></span><span style="color: #990000">():</span>
    <span style="font-weight: bold"><span style="color: #0000FF">pass</span></span></tt></pre></div></div>
<div class="paragraph"><p>Now we expect a moan about arguments:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>Traceback (most recent call last):
  File "tests.py", line 3, in &lt;module&gt;
    assert add('I', 'I') == 'II'
TypeError: add() takes no arguments (2 given)</code></pre>
</div></div>
<div class="paragraph"><p>Let&#8217;s fix that:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>def add(augend, addend):
    pass</code></pre>
</div></div>
<div class="paragraph"><p>(Hat tip to Kent Beck once again for teaching me the word "augend"&#8201;&#8212;&#8201;amongst many other things!)</p></div>
<div class="listingblock">
<div class="content">
<pre><code>Traceback (most recent call last):
  File "tests.py", line 3, in &lt;module&gt;
    assert add('I', 'I') == 'II'
AssertionError</code></pre>
</div></div>
<div class="paragraph"><p>&#8220;AssertionError&#8221; isn&#8217;t very helpful - let&#8217;s make our tests a bit more
verbose in their failure message:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.6
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">from</span></span> rome <span style="font-weight: bold"><span style="color: #000080">import</span></span> add

result <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">add</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'I'</span><span style="color: #990000">,</span> <span style="color: #FF0000">'I'</span><span style="color: #990000">)</span>
<span style="font-weight: bold"><span style="color: #0000FF">assert</span></span> result <span style="color: #990000">==</span> <span style="color: #FF0000">'II'</span><span style="color: #990000">,</span> <span style="color: #FF0000">'add did not return II, it returned %s'</span> <span style="color: #990000">%</span> result</tt></pre></div></div>
<div class="paragraph"><p>That&#8217;s a bit better:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>Traceback (most recent call last):
  File "tests.py", line 4, in &lt;module&gt;
    assert result == 'II', 'add did not return II, it returned %s' % result
AssertionError: add did not return II, it returned None</code></pre>
</div></div>
<div class="paragraph"><p>Writing our own error messages is a bit tedious though.  Time to bring in some
testing tools:</p></div>
</div>
<div class="sect2">
<h3 id="_the_python_code_unittest_code_module">The Python <code>unittest</code> module</h3>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.6
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">import</span></span> unittest
<span style="font-weight: bold"><span style="color: #000080">from</span></span> rome <span style="font-weight: bold"><span style="color: #000080">import</span></span> add

<span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="font-weight: bold"><span style="color: #000000">AdditionTest</span></span><span style="color: #990000">(</span>unittest<span style="color: #990000">.</span>TestCase<span style="color: #990000">):</span>

    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">test_adding_Is</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>
        self<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">assertEqual</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">add</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'I'</span><span style="color: #990000">,</span> <span style="color: #FF0000">'I'</span><span style="color: #990000">),</span> <span style="color: #FF0000">'II'</span><span style="color: #990000">)</span>


<span style="font-weight: bold"><span style="color: #0000FF">if</span></span> __name__ <span style="color: #990000">==</span> <span style="color: #FF0000">'__main__'</span><span style="color: #990000">:</span>
    unittest<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">main</span></span><span style="color: #990000">()</span></tt></pre></div></div>
<div class="paragraph"><p><code>unittest</code> is Python&#8217;s main built-in testing tool; it has lots of tools to help
structure our tests, tools to run them and report passes and failures, and
dozens of useful functions like <code>assertEqual</code>, which can help us to make
assertions about our code, and report back with useful messages:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>F
======================================================================
FAIL: test_adding_Is (__main__.AdditionTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "tests.py", line 7, in test_adding_Is
    self.assertEqual(add('I', 'I'), 'II')
AssertionError: None != 'II'

----------------------------------------------------------------------
Ran 1 test in 0.001s

FAILED (failures=1)</code></pre>
</div></div>
<div class="paragraph"><p>Tests in <code>unittest</code> are structured as methods on classes - the rule is that any
method whose name starts with <code>test</code> will get run.  <code>unittest.main()</code> will run
all the tests in the current module, and print out any errors.  You can see in
the output that the failure message and traceback is neatly preceded by the
class name (<code>AdditionTest</code>) and the test method name (<code>test_adding_Is</code>).</p></div>
<div class="paragraph"><p>Now let&#8217;s see what we can do to get these tests passing:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.6
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">add</span></span><span style="color: #990000">(</span>augend<span style="color: #990000">,</span> addend<span style="color: #990000">):</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #FF0000">'II'</span></tt></pre></div></div>
<div class="literalblock">
<div class="content">
<pre><code>.
----------------------------------------------------------------------
Ran 1 test in 0.000s

OK</code></pre>
</div></div>
<div class="paragraph"><p>Well, OK, the test is passing, but it&#8217;s pretty clear that we&#8217;ve cheated.
Still, returning a hard-coded value like this is often a useful first step.  If
you&#8217;re dealing with complex code that&#8217;s built into a huge application, a
function that &#8220;cheats&#8221; is still useful, because we can then check that it
integrates with the rest of the application.</p></div>
<div class="paragraph"><p>We know we&#8217;ve cheated, and it&#8217;s definitely nagging at us though.  But, in order
to justify changing the code, we have to write another test:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.6
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">test_adding_Is</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>
    self<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">assertEqual</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">add</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'I'</span><span style="color: #990000">,</span> <span style="color: #FF0000">'I'</span><span style="color: #990000">),</span> <span style="color: #FF0000">'II'</span><span style="color: #990000">)</span>
    self<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">assertEqual</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">add</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'I'</span><span style="color: #990000">,</span> <span style="color: #FF0000">'II'</span><span style="color: #990000">),</span> <span style="color: #FF0000">'III'</span><span style="color: #990000">)</span></tt></pre></div></div>
<div class="paragraph"><p>That gives us a failing test:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>F
======================================================================
FAIL: test_adding_Is (__main__.AdditionTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "tests.py", line 8, in test_adding_Is
    self.assertEqual(add('I', 'II'), 'III')
AssertionError: 'II' != 'III'

----------------------------------------------------------------------
Ran 1 test in 0.001s

FAILED (failures=1)</code></pre>
</div></div>
<div class="paragraph"><p>Which lets us have another crack at it, and write a slightly better
implementation of add:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.6
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">add</span></span><span style="color: #990000">(</span>augend<span style="color: #990000">,</span> addend<span style="color: #990000">):</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> augend <span style="color: #990000">+</span> addend</tt></pre></div></div>
<div class="literalblock">
<div class="content">
<pre><code>.
----------------------------------------------------------------------
Ran 1 test in 0.000s

OK</code></pre>
</div></div>
<div class="paragraph"><p>Hooray!  A passing test.  You might think it&#8217;s a slightly weird calculator so
far, and that using string concatenation to implement addition of numbers isn&#8217;t
likely to be a viable solution long-term, but for now, it works fine.</p></div>
<div class="paragraph"><p>So that&#8217;s our first chapter.  It covered:</p></div>
<div class="ulist"><ul>
<li>
<p>
Using TDD to write the minimum viable Roman Numeral calculator
</p>
</li>
<li>
<p>
the First rule:  Test First!
</p>
</li>
<li>
<p>
how to code with TDD: minimal, incremental changes.
</p>
</li>
<li>
<p>
the Python <code>unittest</code> module
</p>
</li>
</ul></div>
<div class="paragraph"><p>In the next chapter we&#8217;ll take our calculator a little further, and learn about
testing exceptions and using loops to structure test data.</p></div>
</div>
</div>
</div>
</div>
<div id="footnotes"><hr /></div>
<div id="footer">
<div id="footer-text">
Last updated 2013-01-26 20:36:42 GMT
</div>
</div>
</body>
</html>
